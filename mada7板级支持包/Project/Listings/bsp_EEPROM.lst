C51 COMPILER V9.60.0.0   BSP_EEPROM                                                        08/13/2021 21:15:40 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BSP_EEPROM
OBJECT MODULE PLACED IN .\Objects\bsp_EEPROM.obj
COMPILER INVOKED BY: E:\KEILMDK\MDK5\C51\BIN\C51.EXE ..\Libraries\FWlib\src\bsp_EEPROM.c OPTIMIZE(8,SPEED) BROWSE INCDIR
                    -(..\Libraries\CMSIS\startup;..\Libraries\CMSIS;..\Libraries\FWlib\src;..\Libraries\FWlib\inc;..\Libraries\FWlib;..\User)
                    - DEBUG OBJECTEXTEND PRINT(.\Listings\bsp_EEPROM.lst) TABS(2) OBJECT(.\Objects\bsp_EEPROM.obj)

line level    source

   1          #include "bsp_EEPROM.h"
   2          
   3          #if BSP_EEPROM
              
              void EEPROM_Disable()
              {
                IAP_CMD=0x00;
                IAP_CONTR=0x00;
              }
              void EEPROM_SectorErase(unsigned short eeprom_address)
              {
                IAP_CMD=0x03;
                IAP_TRIG=0x5A;
                IAP_TRIG=0xA5;
                EEPROM_Disable();
              }
              void EEPROM_Read(unsigned short eeprom_address,unsigned char *read_data,unsigned char length)
              {
                IAP_CMD=0x01;
              //  IAP_CONTR=0xC7;
                IAP_CONTR=0x87;
                printf("3");
                do
                {
                  IAP_ADDRH=eeprom_address/256;
                  IAP_ADDRL=eeprom_address%256;
                  IAP_TRIG=0x5A;
                  IAP_TRIG=0xA5;
                  printf("4");
                  if((eeprom_address+length-1)>0xF3FF)
                  {
                    printf("Out of read range\n");
                    EEPROM_Disable();
                    break;
                  }
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  printf("5");
                  *read_data=IAP_DATA;
                  length--;
                  read_data++;
                  eeprom_address++;
                }while(length);
                printf("6");
                EEPROM_Disable();
              }
              void EEPROM_Write(unsigned short eeprom_address,unsigned char *write_data,unsigned char length)
C51 COMPILER V9.60.0.0   BSP_EEPROM                                                        08/13/2021 21:15:40 PAGE 2   

              {
                EEPROM_SectorErase(eeprom_address&0xFE00);
                IAP_CMD=0x02;
              //  IAP_CONTR=0xC7;
                IAP_CONTR=0x87;
                do
                {
                  IAP_ADDRH=eeprom_address/256;
                  IAP_ADDRL=eeprom_address%256;
                  IAP_TRIG=0x5A;
                  IAP_TRIG=0xA5;
                  if((eeprom_address+length-1)>0xF3FF)
                  {
                    printf("Out of write range\n");
                    EEPROM_Disable();
                    break;
                  }
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  nop();
                  IAP_DATA=*write_data;
                  length--;
                  write_data++;
                  eeprom_address++;
                }while(length);
                EEPROM_Disable();
              }
              
              #endif
  88          
  89          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
